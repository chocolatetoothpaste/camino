"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};!function(){function t(){this.version="1.0.0"}var e={routes:[],def:[],options:{},location:"",hash:""};t.prototype.event={error:"camino.error",route:"camino.route",request:"camino.request",match:"camino.match",nohash:"camino.nohash",exec:"camino.exec"},t.prototype.listen=function(t,o,r){var n=this,s={decode:!0,history:!0,hash:!0,init:!0,sort:!0};if("function"==typeof o)r=o,o=s;else if(void 0===o)o=s;else for(var i in s)o[i]=void 0===o[i]?s[i]:o[i];e.options=o,o.sort&&this.sort(),t.addEventListener(this.event.match,function(t){n.emit(n.event.exec),t.detail.request.route.callback.call(null,t.detail.request)}),t.addEventListener("popstate",function(){n.resolve(event,r,o)},!1),o.init&&this.init()},t.prototype.resolve=function(t,o,r){var n={request:t.target.location,response:o};r.history&&(!e.location&&e.hash!==n.request.hash||""===n.request.hash)&&(e.location=JSON.stringify({path:n.request.pathname,query:n.request.search}),n.path=n.request.pathname,n.url=n.request.pathname+n.request.search,this._exec(n)),r.hash&&(e.hash=n.request.hash,""===n.request.hash?this.emit(this.event.nohash,n):(n.path=e.hash,this._exec(n)))},t.prototype.init=function(){var t=new RegExp(e.def.join("|"));window.addEventListener("click",function(e){if("A"===e.target.tagName&&e.target.hasAttribute("href")){var o=e.target.getAttribute("href").split("?")[0];t.test(o)&&(window.history.pushState(null,null,o),window.dispatchEvent(new CustomEvent("popstate")),e.preventDefault())}}),window.dispatchEvent(new CustomEvent("popstate"))},t.prototype._exec=function(t){this.emit(this.event.request,t),t.qs=t.request.search.substr(1),t.query={},t.qs.split("&").forEach(function(o){var r=o.split("=");e.options.decode&&(r=r.map(decodeURIComponent)),t.query[r[0]]=r[1]}),this.match(t)},t.prototype.emit=function(t,e,o){void 0===o&&(o=e,e=null);var r={detail:{error:e,request:o}};window.dispatchEvent(new CustomEvent(t,r))},t.prototype.location=function(t,e,o){history.pushState(e,o,t),window.dispatchEvent(new CustomEvent("popstate"))},t.prototype.replace=function(t,e,o){history.replaceState(e,o,t),window.dispatchEvent(new CustomEvent("popstate"))},t.prototype.request=function(t){this._exec({qs:"",query:"",path:t,request:{search:""}})},window.camino=new t,t.prototype.sort=function(){e.routes.sort(function(t,e){return e.sort.length-t.sort.length||!/[@|%]/g.test(t.sort)})},t.prototype.match=function(t){for(var o=null,r=null,n=0,s=e.routes.length;n<s;n++)if(o=RegExp(e.routes[n].match,"g").exec(t.path),null!==o){r={route:e.routes[n].route,callback:e.routes[n].callback,params:e.routes[n].params,responder:e.routes[n].responder,methods:e.routes[n].methods},delete o.index,delete o.input,o.shift();break}if(!o){var i=new Error("Resource not found: "+t.path);return i.status=404,this.emit(this.event.error,i,t),!1}if(r.methods.length>0&&-1===r.methods.indexOf(t.method)){var i=new Error("Method not allowed");return i.status=405,this.emit(this.event.error,i,t),!1}t.response=r.responder||t.response,t.route=r,t.params={},o.forEach(function(e,n){void 0!==o[n]&&(t.params[r.params[n]]=e)}),this.emit(this.event.match,t)},t.prototype.route=function(t,o,r){if("function"==typeof o&&(r=o,o={}),"function"!=typeof r)throw new Error("Invalid callback type: "+(void 0===r?"undefined":_typeof(r)));var n=(t.match(/[@|%]\w+/g)||[]).map(function(t){return t.substr(1)}),s=t.replace(/@(\w+)/g,"([\\w\\-\\.]+)").replace(/\/%(\w+)/g,"(?:/?|/([\\w\\-\\.]+))");if(s="^"+s+"$",-1!==e.def.indexOf(s))throw new Error("Route is already defined: "+t);var i={route:t,match:s,sort:t.replace(/([@|%])\w+/g,"$1"),callback:r,params:n,responder:o.responder,methods:o.methods||[]};void 0!==e.options.defaultMethods&&(i.methods=i.methods.concat(e.options.defaultMethods)),e.routes.push(i),e.def.push(s),this.emit(this.event.route,i)}}();