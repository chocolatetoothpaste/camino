!function(){"use strict";function e(){}var t={routes:[],options:{}};e.prototype.event={error:"camino.error",route:"camino.route",request:"camino.request",match:"camino.match",exec:"camino.exec"},e.prototype.listen=function(e,r,o){var s={decode:!0,history:!0,hash:!0,init:!0,sort:!0};if("function"==typeof r)o=r,r=s;else if("undefined"==typeof r)r=s;else for(var n in s)r[n]="undefined"==typeof r[n]?s[n]:r[n];if(t.options=r,this.init(),e.addEventListener(this.event.match,function(e){this.emit(this.event.exec),e.detail.request.route.callback.call(null,e.detail.request)}.bind(this)),r.history){var i={},a="";e.addEventListener("popstate",function(t){var s={request:e.location,response:o},n={path:s.request.pathname,query:s.request.search};JSON.stringify(n)!==JSON.stringify(i)&&(s.path=s.request.pathname,s.url=s.request.pathname+s.request.search,i={path:s.request.pathname,query:s.request.search},this._exec(s)),r.hash&&s.request.hash!==a&&(t.preventDefault(),s.path=s.request.pathname,a=s.request.hash,""!==a&&this._exec(s))}.bind(this),!1),r.init&&window.dispatchEvent(new Event("popstate"))}},e.prototype._exec=function(e){this.emit(this.event.request,e),e.qs=e.request.search.substr(1),e.query={},t.options.decode&&(e.qs=decodeURI(e.qs)),e.qs.split("&").forEach(function(t){var r=t.split("=");e.query[r[0]]=r[1]}),this.match(e)},e.prototype.emit=function(e,t,r){"undefined"==typeof r&&(r=t,t=null);var o={detail:{error:t,request:r}};window.dispatchEvent(new CustomEvent(e,o))},window.camino=new e,e.prototype.init=function(){t.options.sort&&t.routes.sort(function(e,t){return t.sort.length-e.sort.length||!/[@|%]/g.test(e.sort)})},e.prototype.match=function r(e){for(var r=null,o=null,s=0,n=t.routes.length;n>s;s++)if(r=RegExp(t.routes[s].match,"g").exec(e.path),null!==r){o={route:t.routes[s].route,callback:t.routes[s].callback,params:t.routes[s].params,responder:t.routes[s].responder,methods:t.routes[s].methods},delete r.index,delete r.input,r.shift(),r.forEach(function(t,s){"undefined"!=typeof r[s]&&(e.params[o.params[s]]=t)});break}if(!r){var i=new Error("Resource not found: "+e.path);return i.status=404,void this.emit(this.event.error,i,e)}if(o.methods.length>0&&-1===o.methods.indexOf(e.method)){var i=new Error("Method not allowed");return i.status=405,void this.emit(this.event.error,i,e)}e.response=o.responder||e.response,e.route=o,e.params={},this.emit(this.event.match,e)},e.prototype.route=function o(e,r,s){"function"==typeof r&&(s=r,r={});var n=(e.match(/[@|%]\w+/g)||[]).map(function(e){return e.substr(1)}),i=e.replace(/@(\w+)/g,"([\\w\\-\\.]+)").replace(/\/%(\w+)/g,"(?:/?|/([\\w\\-\\.]+))");i="^"+i+"$";var o={route:e,match:i,sort:e.replace(/([@|%])\w+/g,"$1"),callback:s,params:n,responder:r.responder,methods:r.methods||[]};t.routes.push(o),this.emit(this.event.route,o)}}();