!function(){"use strict";function e(){}var t={routes:[],def:[],options:{}};e.prototype.event={error:"camino.error",route:"camino.route",request:"camino.request",match:"camino.match",nohash:"camino.nohash",exec:"camino.exec"},e.prototype.listen=function(e,o,n){var r={decode:!0,history:!0,hash:!0,init:!0,sort:!0};if("function"==typeof o)n=o,o=r;else if("undefined"==typeof o)o=r;else for(var s in r)o[s]="undefined"==typeof o[s]?r[s]:o[s];t.options=o,this.init(),e.addEventListener(this.event.nohash,function(e){console.log("no hash",e)}.bind(this),!1),e.addEventListener(this.event.match,function(e){this.emit(this.event.exec),e.detail.request.route.callback.call(null,e.detail.request)}.bind(this));var i={request:e.location,response:n},a=null;e.addEventListener("popstate",function(){i.path=i.request.pathname,i.url=i.request.pathname+i.request.search,this._exec(i)}.bind(this),!1),e.addEventListener("hashchange",function(){!o.hash||a&&i.request.hash===a||(i.path=i.request.hash,""===i.request.hash?this.emit(this.event.nohash,null,i):this._exec(i))}.bind(this),!1),o.init&&window.dispatchEvent(new Event("popstate"))},e.prototype._exec=function(e){this.emit(this.event.request,e),e.qs=e.request.search.substr(1),e.query={},t.options.decode&&(e.qs=decodeURI(e.qs)),e.qs.split("&").forEach(function(t){var o=t.split("=");e.query[o[0]]=o[1]}),this.match(e)},e.prototype.emit=function(e,t,o){"undefined"==typeof o&&(o=t,t=null);var n={detail:{error:t,request:o}};window.dispatchEvent(new CustomEvent(e,n))},e.prototype.location=function(e,t,o){history.pushState(t,o,e),window.dispatchEvent(new Event("popstate"))},e.prototype.replace=function(e,t,o){history.replaceState(t,o,e),window.dispatchEvent(new Event("popstate"))},window.camino=new e,e.prototype.init=function(){t.options.sort&&t.routes.sort(function(e,t){return t.sort.length-e.sort.length||!/[@|%]/g.test(e.sort)})},e.prototype.match=function o(e){for(var o=null,n=null,r=0,s=t.routes.length;s>r;r++)if(o=RegExp(t.routes[r].match,"g").exec(e.path),null!==o){n={route:t.routes[r].route,callback:t.routes[r].callback,params:t.routes[r].params,responder:t.routes[r].responder,methods:t.routes[r].methods},delete o.index,delete o.input,o.shift();break}if(!o){var i=new Error("Resource not found: "+e.path);return i.status=404,void this.emit(this.event.error,i,e)}if(n.methods.length>0&&-1===n.methods.indexOf(e.method)){var i=new Error("Method not allowed");return i.status=405,void this.emit(this.event.error,i,e)}e.response=n.responder||e.response,e.route=n,e.params={},o.forEach(function(t,r){"undefined"!=typeof o[r]&&(e.params[n.params[r]]=t)}),this.emit(this.event.match,e)},e.prototype.route=function n(e,o,r){"function"==typeof o&&(r=o,o={});var s=(e.match(/[@|%]\w+/g)||[]).map(function(e){return e.substr(1)}),i=e.replace(/@(\w+)/g,"([\\w\\-\\.]+)").replace(/\/%(\w+)/g,"(?:/?|/([\\w\\-\\.]+))");if(i="^"+i+"$",-1!==t.def.indexOf(e))throw new Error("Route is already defined: "+e);var n={route:e,match:i,sort:e.replace(/([@|%])\w+/g,"$1"),callback:r,params:s,responder:o.responder,methods:o.methods||[]};if(-1!==t.def.indexOf(n.sort))throw new Error("Route is already defined: "+t.routes[t.def.indexOf(n.sort)].route+",  Your route: "+e);t.routes.push(n),t.def.push(n.sort),this.emit(this.event.route,n)}}();