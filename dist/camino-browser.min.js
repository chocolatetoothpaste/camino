!function(){"use strict";function e(){}var t={routes:{},rarr:[],options:{}};e.prototype.event={error:"camino.error",route:"camino.route",request:"camino.request",match:"camino.match",exec:"camino.exec"},e.prototype.listen=function(e,r,n){var o={decode:!0,history:!0,hash:!0,init:!0};if("function"==typeof r)n=r,r=o;else if("undefined"==typeof r)r=o;else for(var s in o)r[s]="undefined"==typeof r[s]?o[s]:r[s];if(t.options=r,e.addEventListener(this.event.match,function(e){this.emit(this.event.exec),e.detail.request.route.callback.call(null,e.detail.request)}.bind(this)),r.history){var i={},a="";e.addEventListener("popstate",function(t){var o={request:e.location,response:n},s={path:o.request.pathname,query:o.request.search};JSON.stringify(s)!==JSON.stringify(i)&&(o.path=o.request.pathname,o.url=o.request.pathname+o.request.search,i={path:o.request.pathname,query:o.request.search},this._exec(o)),r.hash&&o.request.hash!==a&&(t.preventDefault(),o.path=o.request.pathname,a=o.request.hash,""!==a&&this._exec(o))}.bind(this),!1),r.init&&window.dispatchEvent(new Event("popstate"))}},e.prototype._exec=function(e){this.emit(this.event.request,e),e.qs=e.request.search.substr(1),e.query={},t.options.decode&&(e.qs=decodeURI(e.qs)),e.qs.split("&").forEach(function(t){var r=t.split("=");e.query[r[0]]=r[1]}),this.match(e)},e.prototype.emit=function(e,t,r){"undefined"==typeof r&&(r=t,t=null);var n={detail:{error:t,request:r}};window.dispatchEvent(new CustomEvent(e,n))},window.camino=new e,e.prototype.match=function r(e){var r=null;for(var n in t.routes)if(r=RegExp(n,"g").exec(e.path),null!==r)break;if(!r){var o=new Error("Resource not found: "+e.path);return o.status=404,void this.emit(this.event.error,o,e)}if(n=t.routes[n],n.methods.length>0&&-1===n.methods.indexOf(e.method)){var o=new Error("Method not allowed");return o.status=405,void this.emit(this.event.error,o,e)}delete r.index,delete r.input,r.shift(),e.response=n.responder||e.response,e.route=n,e.params={},r.forEach(function(t,o){"undefined"!=typeof r[o]&&(e.params[n.params[o]]=t)}),this.emit(this.event.match,e)},e.prototype.route=function n(e,r,o){"function"==typeof r&&(o=r,r={});var s=(e.match(/[@|%]\w+/g)||[]).map(function(e){return e.substr(1)}),n=e.replace(/@(\w+)/g,"([\\w\\-\\.]+)").replace(/\/%(\w+)/g,"(?:/?|/([\\w\\-\\.]+))");if(n="^"+n+"$","undefined"!=typeof t.routes[n])throw new Error("Route is already defined: "+e);t.routes[n]={route:e,callback:o,params:s,responder:r.responder,methods:r.methods||[]},this.emit(this.event.route,t.routes[n])}}();