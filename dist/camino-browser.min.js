!function(){"use strict";function t(){this.version="0.15.2"}var e={routes:[],def:[],options:{},location:"",hash:""};t.prototype.event={error:"camino.error",route:"camino.route",request:"camino.request",match:"camino.match",nohash:"camino.nohash",exec:"camino.exec"},t.prototype.listen=function(t,o,r){var s={decode:!0,history:!0,hash:!0,init:!0,sort:!0};if("function"==typeof o)r=o,o=s;else if(void 0===o)o=s;else for(var n in s)o[n]=void 0===o[n]?s[n]:o[n];e.options=o,this.sort(),t.addEventListener(this.event.match,function(t){this.emit(this.event.exec),t.detail.request.route.callback.call(null,t.detail.request)}.bind(this)),t.addEventListener("popstate",function(){this.resolve(event,r,o)}.bind(this),!1),o.init&&this.init()},t.prototype.resolve=function(t,o,r){var s={request:t.target.location,response:o};r.history&&(!e.location&&e.hash!==s.request.hash||""===s.request.hash)&&(e.location=JSON.stringify({path:s.request.pathname,query:s.request.search}),s.path=s.request.pathname,s.url=s.request.pathname+s.request.search,this._exec(s)),r.hash&&(e.hash=s.request.hash,""===s.request.hash?this.emit(this.event.nohash,s):(s.path=e.hash,this._exec(s)))},t.prototype.init=function(){window.addEventListener("click",function(t){if("A"===t.target.tagName){var e=t.target.getAttribute("href");null!==e&&(window.history.pushState(null,null,e),window.dispatchEvent(new CustomEvent("popstate")),t.preventDefault())}}),window.dispatchEvent(new CustomEvent("popstate"))},t.prototype._exec=function(t){this.emit(this.event.request,t),t.qs=t.request.search.substr(1),t.query={},t.qs.split("&").forEach(function(o){var r=o.split("=");e.options.decode&&(r=r.map(decodeURIComponent)),t.query[r[0]]=r[1]}),this.match(t)},t.prototype.emit=function(t,e,o){void 0===o&&(o=e,e=null);var r={detail:{error:e,request:o}};window.dispatchEvent(new CustomEvent(t,r))},t.prototype.location=function(t,e,o){history.pushState(e,o,t),window.dispatchEvent(new CustomEvent("popstate"))},t.prototype.replace=function(t,e,o){history.replaceState(e,o,t),window.dispatchEvent(new CustomEvent("popstate"))},t.prototype.request=function(t){this._exec({qs:"",query:"",path:t,request:{search:""}})},window.camino=new t,t.prototype.sort=function(){e.options.sort&&e.routes.sort(function(t,e){return e.sort.length-t.sort.length||!/[@|%]/g.test(t.sort)})},t.prototype.match=function(t){for(var o=null,r=null,s=0,n=e.routes.length;s<n;s++)if(o=RegExp(e.routes[s].match,"g").exec(t.path),null!==o){r={route:e.routes[s].route,callback:e.routes[s].callback,params:e.routes[s].params,responder:e.routes[s].responder,methods:e.routes[s].methods},delete o.index,delete o.input,o.shift();break}if(!o){var i=new Error("Resource not found: "+t.path);return i.status=404,void this.emit(this.event.error,i,t)}if(r.methods.length>0&&-1===r.methods.indexOf(t.method)){var i=new Error("Method not allowed");return i.status=405,void this.emit(this.event.error,i,t)}t.response=r.responder||t.response,t.route=r,t.params={},o.forEach(function(e,s){void 0!==o[s]&&(t.params[r.params[s]]=e)}),this.emit(this.event.match,t)},t.prototype.route=function(t,o,r){if("function"==typeof o&&(r=o,o={}),"function"!=typeof r)throw new Error("Invalid callback type: "+typeof r);var s=(t.match(/[@|%]\w+/g)||[]).map(function(t){return t.substr(1)}),n=t.replace(/@(\w+)/g,"([\\w\\-\\.]+)").replace(/\/%(\w+)/g,"(?:/?|/([\\w\\-\\.]+))");if(n="^"+n+"$",-1!==e.def.indexOf(t))throw new Error("Route is already defined: "+t);var i={route:t,match:n,sort:t.replace(/([@|%])\w+/g,"$1"),callback:r,params:s,responder:o.responder,methods:o.methods||[]};if(void 0!==e.options.defaultMethods&&(i.methods=i.methods.concat(e.options.defaultMethods)),-1!==e.def.indexOf(i.sort))throw new Error("Route is already defined: "+e.routes[e.def.indexOf(i.sort)].route+",  Your route: "+t);e.routes.push(i),e.def.push(i.sort),this.emit(this.event.route,i)}}();