!function(){function e(){}var t={routes:{},options:{}};e.prototype.event={error:"camino.error",route:"camino.route",request:"camino.request",match:"camino.match",exec:"camino.exec"},e.prototype.listen=function(e,o,n){var r={decode:!0,history:!1,hash:!0};if("function"==typeof o)n=o,o=r;else if("undefined"==typeof o)o=r;else for(var i in r)o[i]="undefined"==typeof o[i]?r[i]:o[i];t.options=o,t.options.responder=n||console.log.bind(console);var s=e.location;if(o.history){var a=null;e.addEventListener("popstate",function(){s.pathname!==a&&(a=s.request=s.pathname,this._exec(s))}.bind(this),!1)}o.hash&&e.addEventListener("hashchange",function(){s.request=s.hash,this._exec(s)}.bind(this)),e.addEventListener(this.event.match,function(){var e=s.route.responder||t.options.responder;this.emit(this.event.exec),s.route.callback.call(null,s,e)}.bind(this))},e.prototype._exec=function(e){this.emit(this.event.request,e),e.qs=e.search.substr(1),e.query={},t.options.decode&&(e.qs=decodeURI(e.qs)),e.qs.split("&").forEach(function(t){var o=t.split("=");e.query[o[0]]=o[1]}),this.match(e)},e.prototype.emit=function(e,t){window.dispatchEvent(new CustomEvent(e,{detail:t}))},e.prototype.error=function(e){console.log(e.detail)},window.camino=new e,window.addEventListener(window.camino.event.error,window.camino.error),e.prototype.match=function(e){var o=null;for(var n in t.routes)if(o=RegExp(n,"g").exec(e.request),null!==o)break;if(!o){var r=new Error("Resource not found: "+e.request);return r.status=404,this.emit(this.event.error,r),!1}if(n=t.routes[n],n.methods.length>0&&-1===n.methods.indexOf(e.method)){var r=new Error("Method not allowed");return r.status=405,this.emit(this.event.error,r),!1}return e.route=n,delete o.index,delete o.input,o.shift(),e.params={},o.forEach(function(t,r){"undefined"!=typeof o[r]&&(e.params[n.params[r]]=t)}),this.emit(this.event.match,e),!0},e.prototype.route=function(e,o,n){"function"==typeof o&&(n=o,o={});var r=(e.match(/[@|%]\w+/g)||[]).map(function(e){return e.substr(1)}),i=e.replace(/@(\w+)/g,"(\\w+)").replace(/\/%(\w+)/g,"(?:/?|/(\\w+))");if(i="^"+i+"$","undefined"!=typeof t.routes[i])throw new Error("Route is already defined: "+e);t.routes[i]={route:e,callback:n,params:r,responder:o.responder,methods:o.methods||[]},this.emit(this.event.route,t.routes[i])},e.prototype.logEvents=function(){var e=this;Object.keys(e.event).forEach(function(t){window.addEventListener(e.event[t],function(o){console.log(e.event[t],": ",o)})})},e.prototype.list=function(){console.log(t.routes)}}();