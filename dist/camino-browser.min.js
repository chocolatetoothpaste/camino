!function(){"use strict";function e(){}var t={routes:{},rarr:[],options:{}};e.prototype.event={error:"camino.error",route:"camino.route",request:"camino.request",match:"camino.match",exec:"camino.exec"},e.prototype.listen=function(e,n,r){var o={decode:!0,history:!0,hash:!0,init:!0};if("function"==typeof n)r=n,n=o;else if("undefined"==typeof n)n=o;else for(var i in o)n[i]="undefined"==typeof n[i]?o[i]:n[i];t.options=n;var s={request:e.location,response:r||console.log.bind(console)};if(e.addEventListener(this.event.match,function(e){this.emit(this.event.exec),e.detail.request.route.callback.call(null,e.detail.request)}.bind(this)),n.history){var a=null;e.addEventListener("popstate",function(){s.request.pathname+s.request.search!==a&&(s.path=s.request.pathname,a=s.request.pathname+s.request.search,this._exec(s))}.bind(this),!1),n.init&&window.dispatchEvent(new Event("popstate"))}n.hash&&(e.addEventListener("hashchange",function(){s.path=s.request.hash,this._exec(s)}.bind(this)),n.init&&""!==s.request.hash&&window.dispatchEvent(new Event("hashchange")))},e.prototype._exec=function(e){this.emit(this.event.request,e),e.qs=e.request.search.substr(1),e.query={},t.options.decode&&(e.qs=decodeURI(e.qs)),e.qs.split("&").forEach(function(t){var n=t.split("=");e.query[n[0]]=n[1]}),this.match(e)},e.prototype.emit=function(e,t,n){"undefined"==typeof n&&(n=t,t=null);var r={detail:{error:t,request:n}};window.dispatchEvent(new CustomEvent(e,r))},window.camino=new e,e.prototype.match=function n(e){var n=null;for(var r in t.routes)if(n=RegExp(r,"g").exec(e.path),null!==n)break;if(!n){var o=new Error("Resource not found: "+e.path);return o.status=404,void this.emit(this.event.error,o,e)}if(r=t.routes[r],r.methods.length>0&&-1===r.methods.indexOf(e.method)){var o=new Error("Method not allowed");return o.status=405,void this.emit(this.event.error,o,e)}delete n.index,delete n.input,n.shift(),e.route=r,e.params={},n.forEach(function(t,o){"undefined"!=typeof n[o]&&(e.params[r.params[o]]=t)}),this.emit(this.event.match,e)},e.prototype.route=function r(e,n,o){"function"==typeof n&&(o=n,n={});var i=(e.match(/[@|%]\w+/g)||[]).map(function(e){return e.substr(1)}),r=e.replace(/@(\w+)/g,"(\\w+)").replace(/\/%(\w+)/g,"(?:/?|/(\\w+))");if(r="^"+r+"$","undefined"!=typeof t.routes[r])throw new Error("Route is already defined: "+e);t.routes[r]={route:e,callback:o,params:i,responder:n.responder,methods:n.methods||[]},this.emit(this.event.route,t.routes[r])}}();