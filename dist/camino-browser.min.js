!function(){"use strict";function e(){this.version="0.15.1"}var t={routes:[],def:[],options:{}};e.prototype.event={error:"camino.error",route:"camino.route",request:"camino.request",match:"camino.match",nohash:"camino.nohash",exec:"camino.exec"},e.prototype.listen=function(e,o,r){var n={decode:!0,history:!0,hash:!0,init:!0,sort:!0};if("function"==typeof o)r=o,o=n;else if("undefined"==typeof o)o=n;else for(var s in n)o[s]="undefined"==typeof o[s]?n[s]:o[s];t.options=o,this.sort(),e.addEventListener(this.event.match,function(e){this.emit(this.event.exec),e.detail.request.route.callback.call(null,e.detail.request)}.bind(this)),e.addEventListener("popstate",function(){this.resolve(event,r,o)}.bind(this),!1),o.init&&this.init()},e.prototype.resolve=function(e,t,o){var r="",n="",s={request:e.target.location,response:t},i=JSON.stringify({path:s.request.pathname,query:s.request.search});o.history&&(!r&&n!==s.request.hash||""===s.request.hash)&&(r=i,s.path=s.request.pathname,s.url=s.request.pathname+s.request.search,this._exec(s)),o.hash&&(n=s.path=s.request.hash,""===s.request.hash?(n="",this.emit(this.event.nohash,s)):this._exec(s))},e.prototype.init=function(){window.addEventListener("click",function(e){if("A"===e.target.tagName){var o=e.target.getAttribute("href");t.def.indexOf(o.split("?")[0])!==-1&&(window.history.pushState(null,null,o),window.dispatchEvent(new CustomEvent("popstate")),e.preventDefault())}}),window.dispatchEvent(new CustomEvent("popstate"))},e.prototype._exec=function(e){this.emit(this.event.request,e),e.qs=e.request.search.substr(1),e.query={},e.qs.split("&").forEach(function(o){var r=o.split("=");t.options.decode&&(r=r.map(decodeURIComponent)),e.query[r[0]]=r[1]}),this.match(e)},e.prototype.emit=function(e,t,o){"undefined"==typeof o&&(o=t,t=null);var r={detail:{error:t,request:o}};window.dispatchEvent(new CustomEvent(e,r))},e.prototype.location=function(e,t,o){history.pushState(t,o,e),window.dispatchEvent(new CustomEvent("popstate"))},e.prototype.replace=function(e,t,o){history.replaceState(t,o,e),window.dispatchEvent(new CustomEvent("popstate"))},e.prototype.request=function(e){this._exec({qs:"",query:"",path:e,request:{search:""}})},window.camino=new e,e.prototype.sort=function(){t.options.sort&&t.routes.sort(function(e,t){return t.sort.length-e.sort.length||!/[@|%]/g.test(e.sort)})},e.prototype.match=function e(o){for(var e=null,r=null,n=0,s=t.routes.length;n<s;n++)if(e=RegExp(t.routes[n].match,"g").exec(o.path),null!==e){r={route:t.routes[n].route,callback:t.routes[n].callback,params:t.routes[n].params,responder:t.routes[n].responder,methods:t.routes[n].methods},delete e.index,delete e.input,e.shift();break}if(!e){var i=new Error("Resource not found: "+o.path);return i.status=404,void this.emit(this.event.error,i,o)}if(r.methods.length>0&&r.methods.indexOf(o.method)===-1){var i=new Error("Method not allowed");return i.status=405,void this.emit(this.event.error,i,o)}o.response=r.responder||o.response,o.route=r,o.params={},e.forEach(function(t,n){"undefined"!=typeof e[n]&&(o.params[r.params[n]]=t)}),this.emit(this.event.match,o)},e.prototype.route=function e(o,r,n){if("function"==typeof r&&(n=r,r={}),"function"!=typeof n)throw new Error("Invalid callback type: "+typeof n);var s=(o.match(/[@|%]\w+/g)||[]).map(function(e){return e.substr(1)}),i=o.replace(/@(\w+)/g,"([\\w\\-\\.]+)").replace(/\/%(\w+)/g,"(?:/?|/([\\w\\-\\.]+))");if(i="^"+i+"$",t.def.indexOf(o)!==-1)throw new Error("Route is already defined: "+o);var e={route:o,match:i,sort:o.replace(/([@|%])\w+/g,"$1"),callback:n,params:s,responder:r.responder,methods:r.methods||[]};if("undefined"!=typeof t.options.defaultMethods&&(e.methods=e.methods.concat(t.options.defaultMethods)),t.def.indexOf(e.sort)!==-1)throw new Error("Route is already defined: "+t.routes[t.def.indexOf(e.sort)].route+",  Your route: "+o);t.routes.push(e),t.def.push(e.sort),this.emit(this.event.route,e)}}();